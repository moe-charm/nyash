# 🎯 CURRENT TASK - 2025年8月20日

## 📊 現在の状況

### ✅ 完了したタスク
1. **ドキュメント再編成** - 完全完了！
   - 283ファイル → 4大カテゴリに整理
   - Phaseファイルも統合済み
   - 説明書/予定フォルダ削除済み

2. **プラグインBox基本実装** (Phase 9.78c)
   - FileBoxプラグイン実装済み
   - インタープリター経由の呼び出し成功
   - 基本的な引数/戻り値サポート追加（ChatGPT5による）

### 🚧 現在の課題
1. **Bashコマンドエラー問題**
   - docs整理で現在のディレクトリが削除された影響
   - セッション再起動が必要かも

2. **E2Eテスト状況**（tests/e2e_plugin_filebox.rs）
   - インタープリターテスト: ✅ 成功（FileBox.close()が"ok"を返す）
   - デリゲーションテスト: ❓ 未実装の可能性
   - VMテスト: ❌ 失敗（VMはまだプラグインBox未対応）

### 🎯 次のタスク（MIR→VM チェック / 命令最適化）

1) MIR→VM 変換の健全性チェック（短期）
- 現行 MIR 命令 → VM 命令のマッピング表を作成
- E2E/サンプルを VM バックエンドで実行し、MIR→VM 変換ログを収集
- 例外系・Result正規化（returns_result）の経路を VM で確認

2) 命令使用実績の計測（短期）
- 実際に使用されている VM 命令を計測（実行ログ/カウンタ）
- 現行宣言33命令 → 実使用コア命令の抽出

3) 命令セットのダイエット検討（中期）
- 目標: 26命令（docsの合意値）
- 代替可能/統合可能な命令の提案と互換性影響の洗い出し
- 実験フラグで26命令版のVMを試作（段階移行）

4) ドキュメント更新（短期）
- 現状の命令一覧と目標26命令の整合（reference/architecture/）
- 計測結果（使用頻度）と統合方針を追記

### 📝 メモ
- ChatGPT5がプラグインBoxメソッド呼び出しに引数/戻り値サポートを追加
- TLV (Type-Length-Value) エンコーディングで引数をプラグインに渡す実装
- Rustの借用チェッカーとの格闘の跡が見られる（複数回の修正）

### 🔧 推奨アクション
1. VMバックエンドでの実行ログ化（命令発行ログ/カウンタ）
2. マッピング表作成（MIR→VM）と欠落/冗長命令の洗い出し
3. 26命令案のPoCブランチ作成→E2Eで回帰確認
4. docs更新（命令一覧、設計意図、移行戦略）

---
最終更新: 2025年8月22日 03:30（MIR→VM/命令最適化タスク追加）
