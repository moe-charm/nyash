# ğŸ” Nyash WASMå®Ÿè¡Œã«ãŠã‘ã‚‹Rustä¾å­˜æ€§åˆ†æ

## ğŸ“… æœ€çµ‚æ›´æ–°: 2025-08-15

## ğŸ¯ æ¦‚è¦
Nyash WASMã®å®Ÿè¡Œæ™‚Rustä¾å­˜æ€§ã«ã¤ã„ã¦ã€Phase 9.77ï¼ˆæ‰‹å‹•å®Ÿè£…ï¼‰ã¨Phase 9.8+ï¼ˆFFIåŸºç›¤ï¼‰ã‚’æ¯”è¼ƒåˆ†æã—ã€çœŸã®Rustä¾å­˜è„±å´ã®å®Ÿç¾æ–¹æ³•ã‚’è§£èª¬ã€‚

## ğŸ” é‡è¦ãªç™ºè¦‹: å®Ÿè¡Œæ™‚Rustä¾å­˜æ€§ã¯**ã‚¼ãƒ­**

### **çµè«–**
**ã©ã¡ã‚‰ã®æ–¹å¼ã§ã‚‚å®Ÿè¡Œæ™‚Rustä¾å­˜ã¯ãªã—ï¼**

| æ–¹å¼ | ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ | å®Ÿè¡Œæ™‚ | é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ« |
|------|-------------|--------|-------------|
| **Phase 9.77 (æ‰‹å‹•)** | âŒ Rustå¿…è¦ | âœ… **Rustä¸è¦** | .wasm + .js ã®ã¿ |
| **Phase 9.8+ (FFI)** | âŒ Rustå¿…è¦ | âœ… **Rustä¸è¦** | .wasm + .js ã®ã¿ |

## ğŸ› ï¸ Phase 9.77: æ‰‹å‹•å®Ÿè£…ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### **ç‰¹å¾´**
- åŸºæœ¬çš„ãªCanvas/Consoleæ“ä½œã‚’æ‰‹å‹•ã§WASM importå®Ÿè£…
- ç·Šæ€¥å¾©æ—§ã«æœ€é©ï¼ˆ1-2é€±é–“ã§å®Œäº†ï¼‰
- å®Ÿè¡Œæ™‚ã¯WASM + JavaScriptã®ã¿

### **å®Ÿè¡Œæ™‚ä¾å­˜é–¢ä¿‚**
```mermaid
graph LR
    A[ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼] --> B[app.wasm]
    A --> C[importObject.js]
    B --> C
    style A fill:#4ecdc4
    style B fill:#f9ca24
    style C fill:#f0932b
```

### **ç”Ÿæˆä¾‹**
```bash
# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ - Rustå¿…è¦
cargo build --target wasm32-unknown-unknown
# â†’ app.wasm ç”Ÿæˆ

# å®Ÿè¡Œæ™‚ - Rustå®Œå…¨ä¸è¦ï¼
# ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã§WASM + JavaScriptã®ã¿
```

## ğŸš€ Phase 9.8+: FFIåŸºç›¤ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### **ç‰¹å¾´**  
- BIDï¼ˆBox Interface Definitionï¼‰ã‹ã‚‰ã®è‡ªå‹•ç”Ÿæˆ
- æ–°APIè¿½åŠ ãŒæ•°åˆ†ã§å®Œäº†
- é•·æœŸé–‹ç™ºåŠ¹ç‡ã®é£›èºçš„å‘ä¸Š

### **è‡ªå‹•ç”Ÿæˆãƒ•ãƒ­ãƒ¼**
```mermaid
graph TD
    A[BID YAMLå®šç¾©] --> B[nyash bid gen]
    B --> C[WASM importå®£è¨€]
    B --> D[JavaScriptå®Ÿè£…]
    B --> E[Rustç”Ÿæˆã‚³ãƒ¼ãƒ‰]
    C --> F[é…å¸ƒ: WASM + JS]
    D --> F
    style F fill:#2ed573
```

### **ç”Ÿæˆã‚³ãƒãƒ³ãƒ‰**
```bash
# BIDå®šç¾©ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ
nyash bid gen --target wasm bid/canvas.yaml

# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
cargo build --target wasm32-unknown-unknown

# å®Ÿè¡Œæ™‚ - Rustå®Œå…¨ä¸è¦ï¼
# åŒã˜ãWASM + JavaScriptã®ã¿
```

## ğŸ“¦ é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼ˆå…±é€šï¼‰

ã©ã¡ã‚‰ã®æ–¹å¼ã§ã‚‚ã€é…å¸ƒæ™‚ã¯ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿:

```
my_nyash_app/
â”œâ”€â”€ app.wasm           # ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ¸ˆã¿WASMï¼ˆRustä¸è¦ï¼‰
â”œâ”€â”€ runtime.js         # importObjectå®Ÿè£…ï¼ˆJavaScriptï¼‰
â”œâ”€â”€ index.html         # HTMLãƒšãƒ¼ã‚¸
â””â”€â”€ README.md          # ä½¿ç”¨èª¬æ˜
```

## ğŸŒ å®Ÿéš›ã®å®Ÿè¡Œä¾‹

### **HTMLãƒ•ã‚¡ã‚¤ãƒ«**ï¼ˆRustä¸€åˆ‡ä¸è¦ï¼‰
```html
<!DOCTYPE html>
<html>
<head><title>Nyash App</title></head>
<body>
    <canvas id="gameCanvas" width="400" height="300"></canvas>
    <script src="runtime.js"></script>
    <script>
        // WASMãƒ­ãƒ¼ãƒ‰ãƒ»å®Ÿè¡Œï¼ˆRustä¾å­˜ãªã—ï¼‰
        WebAssembly.instantiateStreaming(
            fetch('app.wasm'), 
            importObject
        ).then(instance => {
            instance.exports.main();
        });
    </script>
</body>
</html>
```

### **å®Ÿè¡Œç’°å¢ƒè¦ä»¶**
- âœ… ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ï¼ˆChrome, Firefox, Safari, Edgeï¼‰
- âœ… WebAssemblyå¯¾å¿œ
- âŒ Rustä¸è¦
- âŒ Node.jsä¸è¦  
- âŒ ç‰¹åˆ¥ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä¸è¦

## ğŸ“Š æ–¹å¼æ¯”è¼ƒè©³ç´°

| è©•ä¾¡è»¸ | Phase 9.77 æ‰‹å‹• | Phase 9.8+ FFI |
|--------|-----------------|----------------|
| **å®Ÿè¡Œæ™‚Rustä¾å­˜** | âŒ ãªã— | âŒ ãªã— |
| **é…å¸ƒãƒ•ã‚¡ã‚¤ãƒ«** | WASM + JS | WASM + JS |
| **é–‹ç™ºæ™‚é–“** | 1-2é€±é–“ | 3-4é€±é–“ |
| **APIè¿½åŠ å·¥æ•°** | æ•°æ™‚é–“ï¼ˆæ‰‹å‹•ï¼‰ | æ•°åˆ†ï¼ˆè‡ªå‹•ï¼‰ |
| **ä¿å®ˆæ€§** | ä½ | é«˜ |
| **æ‹¡å¼µæ€§** | é™å®šçš„ | ç„¡åˆ¶é™ |
| **å­¦ç¿’ã‚³ã‚¹ãƒˆ** | ä¸­ | é«˜ |

## ğŸ¯ å®Ÿç”¨çš„é¸æŠæŒ‡é‡

### **Phase 9.77ã‚’é¸ã¶ã¹ãå ´åˆ**
- âœ… **å³åº§ã«Rustä¾å­˜è„±å´ã—ãŸã„**
- âœ… **åŸºæœ¬çš„ãªCanvas/Consoleæ“ä½œã§ååˆ†**
- âœ… **çŸ­æœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**
- âœ… **å­¦ç¿’ã‚³ã‚¹ãƒˆæœ€å°åŒ–**

### **Phase 9.8+ã‚’é¸ã¶ã¹ãå ´åˆ**
- âœ… **é•·æœŸé–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**
- âœ… **å¤šæ§˜ãªå¤–éƒ¨APIçµ±åˆãŒå¿…è¦**
- âœ… **ãƒãƒ¼ãƒ é–‹ç™º**
- âœ… **APIæ‹¡å¼µã®è‡ªå‹•åŒ–ãŒé‡è¦**

## ğŸ’¡ æˆ¦ç•¥çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### **æ®µéšçš„é€²åŒ–ãƒ‘ã‚¹**
```mermaid
graph LR
    A[ç¾åœ¨: Rustä¾å­˜] --> B[Phase 9.77: æ‰‹å‹•WASM]
    B --> C[Phase 9.8+: FFIåŸºç›¤]
    C --> D[å®Œå…¨è‡ªå‹•åŒ–]
    
    style A fill:#ff6b6b
    style B fill:#f9ca24
    style C fill:#4ecdc4
    style D fill:#2ed573
```

### **æ¨å¥¨æˆ¦ç•¥**
1. **Phase 9.77**: æ‰‹å‹•å®Ÿè£…ã§å³åº§ã«Rustä¾å­˜è„±å´
2. **æ¤œè¨¼**: å®Ÿç”¨æ€§ãƒ»æ€§èƒ½ç¢ºèª
3. **Phase 9.8+**: å¿…è¦ã«å¿œã˜ã¦FFIåŸºç›¤ã¸ç§»è¡Œ

## ğŸ‰ æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### **å³æ™‚åŠ¹æœï¼ˆPhase 9.77ï¼‰**
- **Rustä¾å­˜å®Œå…¨æ’é™¤**ï¼ˆå®Ÿè¡Œæ™‚ï¼‰
- **é…å¸ƒã®ç°¡ç´ åŒ–**
- **ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼å˜ä½“å®Ÿè¡Œ**
- **å­¦ç¿’ã‚³ã‚¹ãƒˆå‰Šæ¸›**

### **é•·æœŸåŠ¹æœï¼ˆPhase 9.8+ï¼‰**
- **é–‹ç™ºåŠ¹ç‡ã®é£›èºçš„å‘ä¸Š**
- **APIæ‹¡å¼µã®è‡ªå‹•åŒ–**  
- **ãƒãƒ¼ãƒ é–‹ç™ºã®æ¨™æº–åŒ–**
- **ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ æ‹¡å……**

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### **æŠ€è¡“ä»•æ§˜**
- [FFI/ABIä»•æ§˜](../reference/box-design/ffi-abi-specification.md)
- [å®Ÿè¡Œãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰](../execution-backends.md)

### **å®Ÿè£…è¨ˆç”»**  
- [Phase 9.77è©³ç´°](../../äºˆå®š/native-plan/issues/phase_9_77_wasm_emergency.md)
- [Copilot Issues](../../äºˆå®š/native-plan/copilot_issues.txt)

### **å•é¡Œåˆ†æ**
- [WASMç¾åœ¨ã®å•é¡Œ](../../äºˆå®š/wasm/current_issues.md)

---

**ã“ã®åˆ†æã«ã‚ˆã‚Šã€Nyashã¯WASMã‚’é€šã˜ã¦çœŸã®Rustä¾å­˜è„±å´ã‚’å®Ÿç¾ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ç’°å¢ƒã§ã®è‡ªç”±ãªå®Ÿè¡ŒãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚** ğŸš€