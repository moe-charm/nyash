// FFI-ABI File I/O test
// ç´”ç²‹FFI-ABIæ–¹å¼ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œãƒ‡ãƒ¢

using nyashstd

// ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ•ã‚¡ã‚¤ãƒ«å
local test_file = "test_output.txt"

// ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿
file.write(test_file, "Hello from Nyash FFI-ABI!\nThis is a test of file I/O.")
console.log("âœ… File written: " + test_file)

// ãƒ•ã‚¡ã‚¤ãƒ«ã®å­˜åœ¨ç¢ºèª
if file.exists(test_file) {
    console.log("âœ… File exists!")
    
    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã¿
    local content = file.read(test_file)
    if content != null {
        console.log("âœ… File content:")
        console.log(content)
        
        // å†…å®¹ã‚’è¿½è¨˜
        file.write(test_file, content + "\nAdded line at: " + new StringBox("timestamp"))
        console.log("âœ… Content appended")
        
        // å†åº¦èª­ã¿è¾¼ã¿
        local updated = file.read(test_file)
        console.log("âœ… Updated content:")
        console.log(updated)
    } else {
        console.log("âŒ Failed to read file")
    }
} else {
    console.log("âŒ File does not exist")
}

// å­˜åœ¨ã—ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚‚ã†ã¨ã™ã‚‹
local missing = file.read("non_existent_file.txt")
if missing == null {
    console.log("âœ… Non-existent file correctly returns null")
} else {
    console.log("âŒ Unexpected content from non-existent file")
}

console.log("\nğŸ‰ FFI-ABI File I/O test complete!")