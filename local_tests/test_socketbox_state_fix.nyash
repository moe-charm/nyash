// SocketBoxçŠ¶æ…‹ä¿æŒå•é¡Œãƒ†ã‚¹ãƒˆ - Phase 9.75-Bä¿®æ­£æ¤œè¨¼
// PR #89ä¿®æ­£å¾Œã®SocketBoxçŠ¶æ…‹æ°¸ç¶šåŒ–ãƒ†ã‚¹ãƒˆ

static box Main {
    init { console, result }
    
    main() {
        me.console = new ConsoleBox()
        me.console.log("ğŸ”§ SocketBoxçŠ¶æ…‹ä¿æŒãƒ†ã‚¹ãƒˆé–‹å§‹")
        
        // SocketBoxä½œæˆ
        local server
        server = new SocketBox()
        me.console.log("âœ… SocketBoxä½œæˆå®Œäº†")
        
        // bindæ“ä½œ - çŠ¶æ…‹è¨­å®š
        local bindResult
        bindResult = server.bind("127.0.0.1", "8080")
        me.console.log("ğŸ”¥ bindçµæœ: " + bindResult.toString())
        
        // é‡è¦ãƒ†ã‚¹ãƒˆï¼šisServer()çŠ¶æ…‹ç¢ºèª
        local isServerBefore
        isServerBefore = server.isServer()
        me.console.log("ğŸ”¥ bindå¾Œã®isServer(): " + isServerBefore.toString())
        
        // toString()ãƒ†ã‚¹ãƒˆ
        local socketString
        socketString = server.toString()
        me.console.log("ğŸ”¥ server.toString(): " + socketString)
        
        // å†åº¦isServer()ç¢ºèª - çŠ¶æ…‹æ°¸ç¶šæ€§ãƒ†ã‚¹ãƒˆ
        local isServerAfter
        isServerAfter = server.isServer()
        me.console.log("ğŸ”¥ 2å›ç›®ã®isServer(): " + isServerAfter.toString())
        
        // listen()ãƒ†ã‚¹ãƒˆ
        local listenResult
        listenResult = server.listen("10")
        me.console.log("ğŸ”¥ listençµæœ: " + listenResult.toString())
        
        // æœ€çµ‚çŠ¶æ…‹ç¢ºèª
        local finalState
        finalState = server.isServer()
        me.console.log("ğŸ”¥ æœ€çµ‚isServer(): " + finalState.toString())
        
        // æœŸå¾…çµæœç¢ºèª
        if finalState.toString() == "true" {
            me.console.log("ğŸ‰ SocketBoxçŠ¶æ…‹ä¿æŒå•é¡Œä¿®æ­£ç¢ºèªï¼")
            me.result = "SUCCESS: SocketBoxçŠ¶æ…‹ãŒæ­£å¸¸ã«ä¿æŒã•ã‚Œã¦ã„ã¾ã™"
        } else {
            me.console.log("âŒ SocketBoxçŠ¶æ…‹ä¿æŒå•é¡ŒãŒæ®‹å­˜")
            me.result = "FAILED: SocketBoxçŠ¶æ…‹ãŒå¤±ã‚ã‚Œã¦ã„ã¾ã™"
        }
        
        // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        server.close()
        me.console.log("âœ… ãƒ†ã‚¹ãƒˆå®Œäº†")
        
        return me.result
    }
}