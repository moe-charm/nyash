// ğŸ§ª InstanceBox v2åŒ…æ‹¬ãƒ†ã‚¹ãƒˆï¼ˆæ–‡å­—åˆ—æ¼”ç®—ãªã—ï¼‰

// è¤‡é›‘ãªãƒã‚¹ãƒˆã—ãŸBoxéšå±¤ã®ãƒ†ã‚¹ãƒˆ
box DatabaseConnection {
    init { host, port, status }
    
    connect(hostname, portnum) {
        me.host = hostname
        me.port = portnum  
        me.status = 1
        return me.status
    }
    
    isConnected() {
        return me.status
    }
}

box UserService {
    init { db_connection, user_cache }
    
    initialize() {
        me.db_connection = new DatabaseConnection()
        me.user_cache = new MapBox()
        
        local result = me.db_connection.connect("localhost", 5432)
        return result
    }
    
    getConnectionStatus() {
        return me.db_connection.isConnected()
    }
    
    addUser(userId, userData) {
        me.user_cache.set(userId, userData)
        return me.user_cache.size()
    }
}

box Application {
    init { user_service, logger }
    
    startup() {
        me.user_service = new UserService()
        me.logger = new ConsoleBox()
        
        local init_result = me.user_service.initialize()
        return init_result
    }
    
    testComplexOperations() {
        // è¤‡é›‘ãªãƒã‚¹ãƒˆã—ãŸãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—
        local status = me.user_service.getConnectionStatus()
        
        // MapBoxã¨ã®é€£æº
        local cache_size = me.user_service.addUser("user1", "data1")
        
        // ãƒ­ã‚°å‡ºåŠ›
        me.logger.log("Application test completed")
        
        return cache_size
    }
}

// ãƒ¡ã‚¤ãƒ³ãƒ†ã‚¹ãƒˆ
static box Main {
    init { app, test_result }
    
    main() {
        me.app = new Application()
        
        // æ®µéšçš„åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
        local startup_result = me.app.startup()
        
        // è¤‡é›‘ãªæ“ä½œãƒ†ã‚¹ãƒˆ  
        me.test_result = me.app.testComplexOperations()
        
        return me.test_result
    }
}