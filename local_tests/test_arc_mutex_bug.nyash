// ğŸ”¥ Arc<Mutex>çŠ¶æ…‹å…±æœ‰ç ´å£Šãƒã‚°ã®æœ€å°å†ç¾ãƒ†ã‚¹ãƒˆ

static box Main {
    init { console, server, result }
    
    main() {
        me.console = new ConsoleBox()
        
        // ğŸ¯ ãƒ†ã‚¹ãƒˆ1: SocketBoxä½œæˆãƒ»bindãƒ»çŠ¶æ…‹ç¢ºèª
        me.console.log("=== Arc<Mutex>çŠ¶æ…‹å…±æœ‰ç ´å£Šãƒã‚°å†ç¾ãƒ†ã‚¹ãƒˆ ===")
        
        // Step 1: SocketBoxä½œæˆ
        me.server = new SocketBox()
        me.console.log("1. SocketBoxä½œæˆå®Œäº†")
        
        // Step 2: bindå®Ÿè¡Œï¼ˆis_server = trueã«è¨­å®šã•ã‚Œã‚‹ã¯ãšï¼‰
        local bind_result
        bind_result = me.server.bind("127.0.0.1", 18080)
        me.console.log("2. bindå®Œäº†, çµæœ: " + bind_result.toString())
        
        // Step 3: çŠ¶æ…‹ç¢ºèªï¼ˆã“ã“ã§clone()ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ï¼‰
        local is_server_check1  
        is_server_check1 = me.server.isServer()
        me.console.log("3. isServer()ãƒã‚§ãƒƒã‚¯1: " + is_server_check1.toString())
        
        // Step 4: å¤‰æ•°å†ä»£å…¥ï¼ˆclone()ç¢ºå®Ÿã«ç™ºç”Ÿï¼‰
        local server_copy
        server_copy = me.server
        me.console.log("4. ã‚µãƒ¼ãƒãƒ¼å¤‰æ•°ã‚³ãƒ”ãƒ¼å®Œäº†")
        
        // Step 5: ã‚³ãƒ”ãƒ¼å¾Œã®çŠ¶æ…‹ç¢ºèª
        local is_server_check2
        is_server_check2 = server_copy.isServer()  
        me.console.log("5. ã‚³ãƒ”ãƒ¼å¾ŒisServer()ãƒã‚§ãƒƒã‚¯2: " + is_server_check2.toString())
        
        // Step 6: å…ƒã®å¤‰æ•°ã§ã®çŠ¶æ…‹ç¢ºèª
        local is_server_check3
        is_server_check3 = me.server.isServer()
        me.console.log("6. å…ƒå¤‰æ•°isServer()ãƒã‚§ãƒƒã‚¯3: " + is_server_check3.toString())
        
        // ğŸ” æœŸå¾…çµæœ vs å®Ÿéš›çµæœ
        me.console.log("")
        me.console.log("=== çµæœåˆ†æ ===")
        me.console.log("æœŸå¾…çµæœ: å…¨ã¦trueã§ã‚ã‚‹ã¹ãï¼ˆArcå…±æœ‰ãªã‚‰ï¼‰")
        me.console.log("å®Ÿéš›çµæœ:")
        me.console.log("  bindå¾Œ: " + is_server_check1.toString())
        me.console.log("  copyå¾Œ: " + is_server_check2.toString()) 
        me.console.log("  å…ƒå¤‰æ•°: " + is_server_check3.toString())
        
        if is_server_check1.toString() == "true" and is_server_check2.toString() == "false" {
            me.console.log("")
            me.console.log("ğŸ”¥ BUG CONFIRMED: clone()ã§Arcå…±æœ‰ãŒç ´å£Šã•ã‚Œã¦ã„ã¾ã™ï¼")
            me.result = "bug_confirmed"
        } else {
            me.console.log("")
            me.console.log("âœ… äºˆæƒ³å¤–: å•é¡ŒãŒä¿®æ­£ã•ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§")
            me.result = "unexpected_fix"
        }
        
        return me.result
    }
}