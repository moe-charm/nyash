# ğŸ”¥ SocketBoxå®Œå…¨ãƒ‡ãƒãƒƒã‚°ãƒˆãƒ¬ãƒ¼ã‚¹
# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ­ã‚°å‡ºåŠ› + ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ¬ãƒ™ãƒ«è¿½è·¡

static box Main {
    init { console, server, result, debug_id }
    
    main() {
        me.console = new ConsoleBox()
        me.debug_id = "TRACE_MAIN"
        me.console.log("ğŸ”¥ SocketBoxå®Œå…¨ãƒ‡ãƒãƒƒã‚°ãƒˆãƒ¬ãƒ¼ã‚¹é–‹å§‹")
        me.console.log("Debug ID: " + me.debug_id)
        
        # Step 1: SocketBoxä½œæˆ
        me.console.log("=== Step 1: SocketBoxä½œæˆ ===")
        me.server = new SocketBox()
        me.console.log("âœ… SocketBoxä½œæˆå®Œäº†")
        me.console.log("ä½œæˆã•ã‚ŒãŸSocketBox: " + me.server.toString())
        
        # Step 2: åˆæœŸçŠ¶æ…‹ç¢ºèª
        me.console.log("=== Step 2: åˆæœŸçŠ¶æ…‹ç¢ºèª ===")
        local initialState = me.server.isServer()
        me.console.log("åˆæœŸisServerçŠ¶æ…‹: " + initialState.toString())
        
        # Step 3: bindå®Ÿè¡Œ (è©³ç´°ãƒ­ã‚°å‡ºåŠ›)
        me.console.log("=== Step 3: bindå®Ÿè¡Œ ===")
        me.console.log("bindå‘¼ã³å‡ºã—å‰ã®SocketBox: " + me.server.toString())
        
        local bindResult = me.server.bind("127.0.0.1", 18080)
        me.console.log("bindæˆ»ã‚Šå€¤: " + bindResult.toString())
        
        # Step 4: bindå¾ŒçŠ¶æ…‹ç¢ºèª
        me.console.log("=== Step 4: bindå¾ŒçŠ¶æ…‹ç¢ºèª ===")
        me.console.log("bindå®Ÿè¡Œå¾Œã®SocketBox: " + me.server.toString())
        
        local postBindState = me.server.isServer()
        me.console.log("bindå¾ŒisServerçŠ¶æ…‹: " + postBindState.toString())
        
        # Step 5: å†ç¢ºèªãƒ†ã‚¹ãƒˆ
        me.console.log("=== Step 5: å†ç¢ºèªãƒ†ã‚¹ãƒˆ ===")
        local recheck1 = me.server.isServer()
        local recheck2 = me.server.isServer()
        me.console.log("å†ç¢ºèª1: " + recheck1.toString())
        me.console.log("å†ç¢ºèª2: " + recheck2.toString())
        
        # Step 6: çµæœåˆ¤å®š
        me.console.log("=== Step 6: çµæœåˆ¤å®š ===")
        if postBindState.equals(true) {
            me.result = "ğŸ‰ SUCCESS: çŠ¶æ…‹ä¿æŒæ­£å¸¸"
            me.console.log(me.result)
        } else {
            me.result = "âŒ FAILED: çŠ¶æ…‹ä¿æŒå¤±æ•—"
            me.console.log(me.result)
            me.console.log("bindçµæœ: " + bindResult.toString())
            me.console.log("æœŸå¾…å€¤: true, å®Ÿéš›å€¤: " + postBindState.toString())
        }
        
        # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        me.server.close()
        me.console.log("ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†")
        
        return me.result
    }
}