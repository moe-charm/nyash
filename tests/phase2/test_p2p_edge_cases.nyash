// ğŸ§ª P2PBox ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ç•°å¸¸ç³»ã®å‹•ä½œæ¤œè¨¼

print("=== P2PBox Edge Cases Test ===")

// åŸºæœ¬ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
local world
world = new IntentBox()

local node1
node1 = new P2PBox("node1", world)

print("\n1. Testing invalid target send")
// å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ã¸ã®é€ä¿¡
local result
result = node1.send("test", "data", "non_existent_node")
print("Send to non-existent node: " + result)

print("\n2. Testing empty intent string")
// ç©ºã®intentæ–‡å­—åˆ—
node1.on("", "empty_handler")
result = node1.send("", "test data", "node1")
print("Empty intent handled: " + result)

print("\n3. Testing duplicate listener removal")
// åŒã˜intentã‚’2å›å‰Šé™¤
node1.on("test_event", "handler1")
result = node1.off("test_event")
print("First removal: " + result)
result = node1.off("test_event")
print("Second removal: " + result)

print("\n4. Testing self-messaging")
// è‡ªåˆ†è‡ªèº«ã¸ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
node1.on("self_msg", "self_handler")
result = node1.send("self_msg", "Hello myself!", "node1")
print("Self message sent: " + result)

print("\n5. Testing very long intent names")
// éå¸¸ã«é•·ã„intentå
local longIntent
longIntent = "this_is_a_very_long_intent_name_that_tests_the_system_limits_1234567890_abcdefghijklmnopqrstuvwxyz"
node1.on(longIntent, "long_handler")
result = node1.send(longIntent, "test", "node1")
print("Long intent handled: " + result)

print("\n6. Testing special characters in node ID")
// ç‰¹æ®Šæ–‡å­—ã‚’å«ã‚€ãƒãƒ¼ãƒ‰IDï¼ˆæ–°è¦ä½œæˆæ™‚ï¼‰
local specialNode
specialNode = new P2PBox("node-with-special_chars.123", world)
print("Special node created: " + specialNode.getNodeId())

print("\n7. Testing rapid fire messages")
// é«˜é€Ÿé€£ç¶šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
local node2
node2 = new P2PBox("node2", world)
node2.on("rapid", "rapid_handler")

local i
i = 0
loop(i < 10) {
    node1.send("rapid", "Message " + i, "node2")
    i = i + 1
}
print("Sent 10 rapid messages")

print("\n8. Testing null data send")
// nullãƒ‡ãƒ¼ã‚¿ã®é€ä¿¡
local nullData
nullData = new NullBox()
result = node1.send("null_test", nullData, "node2")
print("Null data sent: " + result)

print("\n9. Testing listener with same intent multiple times")
// åŒã˜intentã«è¤‡æ•°ã®ãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²
node1.on("multi", "handler1")
node1.on("multi", "handler2")
node1.on("multi", "handler3")
print("Multiple handlers registered for same intent")

print("\n10. Testing IntentBox message processing")
// IntentBoxã®å†…éƒ¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†
result = world.processMessages()
print("IntentBox processed messages: " + result)

print("\n=== Edge Cases Test Complete ===")