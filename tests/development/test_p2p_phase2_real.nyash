// ğŸŒ P2PBox Phase 2: å®Ÿéš›ã®P2Pé€šä¿¡ãƒ†ã‚¹ãƒˆ
// ç›®æ¨™: sendãƒ»isReachable APIå®Ÿè¨¼ãƒ†ã‚¹ãƒˆ

local console
console = new ConsoleBox()
console.log("ğŸŒ Phase 2: å®Ÿéš›ã®P2Pé€šä¿¡ãƒ†ã‚¹ãƒˆé–‹å§‹")

// 2.1 ãƒãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
console.log("\nğŸ”— 2.1 P2Pãƒãƒ¼ãƒ‰ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—")

local alice
local bob
alice = new P2PBox("alice", "inprocess")
bob = new P2PBox("bob", "inprocess")

console.log("âœ… ãƒãƒ¼ãƒ‰ä½œæˆå®Œäº†")
console.log("Alice: " + alice.getNodeId())
console.log("Bob: " + bob.getNodeId())

// 2.2 åˆ°é”å¯èƒ½æ€§ãƒ†ã‚¹ãƒˆ
console.log("\nğŸ” 2.2 åˆ°é”å¯èƒ½æ€§ãƒ†ã‚¹ãƒˆ")

local alice_to_bob
local bob_to_alice
alice_to_bob = alice.isReachable("bob")
bob_to_alice = bob.isReachable("alice")

console.log("Alice â†’ Bob åˆ°é”å¯èƒ½: " + alice_to_bob)
console.log("Bob â†’ Alice åˆ°é”å¯èƒ½: " + bob_to_alice)

// å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
local alice_to_unknown
alice_to_unknown = alice.isReachable("unknown_node")
console.log("Alice â†’ Unknown åˆ°é”å¯èƒ½: " + alice_to_unknown)

// 2.3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ†ã‚¹ãƒˆ
console.log("\nğŸ“¤ 2.3 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ†ã‚¹ãƒˆ")

local greeting
greeting = new IntentBox("greeting", "Hello from Alice!")

console.log("é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:")
console.log("- Intent: " + greeting.getName())
console.log("- Payload: " + greeting.getPayload())

// Alice â†’ Bob ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡
console.log("\nğŸ“¡ Alice â†’ Bob é€ä¿¡å®Ÿè¡Œ...")
local send_result
send_result = alice.send("bob", greeting)
console.log("é€ä¿¡çµæœ: " + send_result)

// 2.4 è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ†ã‚¹ãƒˆ
console.log("\nğŸ“¨ 2.4 è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ãƒ†ã‚¹ãƒˆ")

local chat_msg
local info_msg

chat_msg = new IntentBox("chat", "ã“ã‚“ã«ã¡ã¯ï¼")
info_msg = new IntentBox("info", "ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã§ã™")

local result1
local result2
result1 = alice.send("bob", chat_msg)
result2 = alice.send("bob", info_msg)

console.log("Chaté€ä¿¡çµæœ: " + result1)
console.log("Infoé€ä¿¡çµæœ: " + result2)

// Bob â†’ Alice é€ä¿¡ã‚‚ãƒ†ã‚¹ãƒˆ
local reply_msg
reply_msg = new IntentBox("reply", "è¿”ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ã™")

local result3
result3 = bob.send("alice", reply_msg)
console.log("Bob â†’ Alice é€ä¿¡çµæœ: " + result3)

// 2.5 ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
console.log("\nâš ï¸ 2.5 ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ")

// å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰ã¸ã®é€ä¿¡
local error_msg
error_msg = new IntentBox("test", "This should fail")

console.log("å­˜åœ¨ã—ãªã„ãƒãƒ¼ãƒ‰å®›é€ä¿¡ãƒ†ã‚¹ãƒˆ...")
// ã“ã®ãƒ†ã‚¹ãƒˆã¯ã‚¨ãƒ©ãƒ¼ãŒäºˆæƒ³ã•ã‚Œã‚‹
console.log("äºˆæƒ³: é€ä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ")

// 2.6 Phase 2çµæœçµ±è¨ˆ
console.log("\nğŸ“Š 2.6 Phase 2ãƒ†ã‚¹ãƒˆçµæœ")
console.log("âœ… ãƒãƒ¼ãƒ‰ä½œæˆ: æˆåŠŸ")
console.log("âœ… åˆ°é”å¯èƒ½æ€§ãƒã‚§ãƒƒã‚¯: æˆåŠŸ")
console.log("âœ… ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡: å®Ÿè¡Œæ¸ˆã¿")
console.log("âœ… è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡: å®Ÿè¡Œæ¸ˆã¿")
console.log("âœ… åŒæ–¹å‘é€šä¿¡: å®Ÿè¡Œæ¸ˆã¿")

console.log("\nğŸ‰ Phase 2: åŸºæœ¬P2Pé€šä¿¡æ©Ÿèƒ½ç¢ºèªå®Œäº†ï¼")
console.log("æ¬¡ã¯Phase 3: ãƒ‡ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»overrideé©å‘½ã¸ï¼")