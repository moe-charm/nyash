// P2Pテスト - MapBoxなし版

print("=== P2P No MapBox Test ===")

// MessageHub - MapBox使わない
box MessageHub {
    init { name }
    
    setup() {
        print("MessageHub.setup() ENTER")
        me.name = "CentralHub"
        print("MessageHub.setup() EXIT")
    }
    
    deliver(messageType, data, from) {
        print("MessageHub.deliver() ENTER")
        print("Message: " + from + " -> " + messageType + " = " + data)
        print("MessageHub.deliver() EXIT")
    }
}

// PeerNode
box PeerNode {
    init { nodeId, messageHub }
    
    setup(nodeId, hub) {
        print("PeerNode.setup() ENTER - nodeId: " + nodeId)
        me.nodeId = nodeId
        me.messageHub = hub
        print("PeerNode.setup() EXIT")
    }
    
    send(messageType, data) {
        print("PeerNode.send() ENTER - node: " + me.nodeId)
        print("About to call messageHub.deliver...")
        me.messageHub.deliver(messageType, data, me.nodeId)
        print("PeerNode.send() EXIT")
    }
}

// テスト
print("Creating MessageHub...")
local hub
hub = new MessageHub()
hub.setup()

print("Creating Alice...")
local alice
alice = new PeerNode()
alice.setup("Alice", hub)

print("Test completed!")