// ğŸ“Š çµ±è¨ˆè¨ˆç®—ã‚¢ãƒ—ãƒª - MathBoxæ–°æ©Ÿèƒ½ã‚’æ´»ç”¨ï¼
// Everything is Boxå“²å­¦ã«ã‚ˆã‚‹çµ±è¨ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª

print("ğŸ“Š === Statistics Calculator ===")
print("MathBoxæ‹¡å¼µæ©Ÿèƒ½ã‚’æ´»ç”¨ã—ãŸçµ±è¨ˆè¨ˆç®—ãƒ‡ãƒ¢\n")

// ãƒ‡ãƒãƒƒã‚°ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°é–‹å§‹
DEBUG = new DebugBox()
DEBUG.startTracking()

// çµ±è¨ˆè¨ˆç®—ã‚’è¡Œã†Box
box Statistics {
    init {
        data,
        math
    }
    
    // ãƒ‡ãƒ¼ã‚¿è¿½åŠ 
    func addData(value) {
        me.data.push(value)
    }
    
    // ãƒ‡ãƒ¼ã‚¿ä¸€æ‹¬è¿½åŠ 
    func addMultiple(values) {
        i = 0
        loop(i < values.length()) {
            me.addData(values.get(i))
            i = i + 1
        }
    }
    
    // å¹³å‡å€¤è¨ˆç®—
    func mean() {
        if (me.data.length() == 0) {
            return new NullBox()
        }
        
        sum = 0
        i = 0
        loop(i < me.data.length()) {
            sum = sum + me.data.get(i)
            i = i + 1
        }
        
        // é™¤ç®—ãŒãªã„ã®ã§æ›ã‘ç®—ã§ä»£ç”¨
        count = me.data.length()
        mean = sum * me.math.pow(count, -1)  // sum / count
        return mean
    }
    
    // åˆ†æ•£è¨ˆç®—
    func variance() {
        if (me.data.length() == 0) {
            return new NullBox()
        }
        
        avg = me.mean()
        sumSquaredDiff = 0
        i = 0
        
        loop(i < me.data.length()) {
            diff = me.data.get(i) - avg
            sumSquaredDiff = sumSquaredDiff + (diff * diff)
            i = i + 1
        }
        
        count = me.data.length()
        variance = sumSquaredDiff * me.math.pow(count, -1)
        return variance
    }
    
    // æ¨™æº–åå·®è¨ˆç®—
    func standardDeviation() {
        var = me.variance()
        // NullBoxã‹ã©ã†ã‹ãƒã‚§ãƒƒã‚¯ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ã§åˆ¤å®šï¼‰
        if (var.type_name() == "NullBox") {
            return new NullBox()
        }
        return me.math.sqrt(var)
    }
    
    // æœ€å¤§å€¤
    func max() {
        if (me.data.length() == 0) {
            return new NullBox()
        }
        
        maxVal = me.data.get(0)
        i = 1
        loop(i < me.data.length()) {
            maxVal = me.math.max(maxVal, me.data.get(i))
            i = i + 1
        }
        return maxVal
    }
    
    // æœ€å°å€¤
    func min() {
        if (me.data.length() == 0) {
            return new NullBox()
        }
        
        minVal = me.data.get(0)
        i = 1
        loop(i < me.data.length()) {
            minVal = me.math.min(minVal, me.data.get(i))
            i = i + 1
        }
        return minVal
    }
    
    // ç¯„å›²ï¼ˆãƒ¬ãƒ³ã‚¸ï¼‰
    func range() {
        return me.max() - me.min()
    }
    
    // ãƒ‡ãƒ¼ã‚¿è¡¨ç¤º
    func showData() {
        print("\nğŸ“ˆ Data points (" + me.data.length() + " items):")
        i = 0
        loop(i < me.data.length()) {
            print("  [" + i + "] = " + me.data.get(i))
            i = i + 1
        }
    }
    
    // çµ±è¨ˆã‚µãƒãƒªãƒ¼è¡¨ç¤º
    func summary() {
        print("\nğŸ“Š Statistical Summary:")
        print("  Count: " + me.data.length())
        print("  Mean: " + me.mean())
        print("  Std Dev: " + me.standardDeviation())
        print("  Min: " + me.min())
        print("  Max: " + me.max())
        print("  Range: " + me.range())
    }
}

// çµ±è¨ˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹é–¢æ•°
function createStatistics() {
    stats = new Statistics()
    stats.data = new ArrayBox()
    stats.math = new MathBox()
    return stats
}

// ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã§å®Ÿè¡Œ
print("\nğŸ§ª Test 1: å­¦ç”Ÿã®ãƒ†ã‚¹ãƒˆå¾—ç‚¹åˆ†æ")
stats = createStatistics()
DEBUG.trackBox(stats, "Statistics-TestScores")

// ãƒ†ã‚¹ãƒˆã‚¹ã‚³ã‚¢ã‚’è¿½åŠ 
scores = new ArrayBox()
scores.push(85)
scores.push(92)
scores.push(78)
scores.push(95)
scores.push(88)
scores.push(73)
scores.push(90)
scores.push(82)

stats.addMultiple(scores)
stats.showData()
stats.summary()

// æ–°ã—ã„æ©Ÿèƒ½ï¼šä¸‰è§’é–¢æ•°ã‚’ä½¿ã£ãŸå‘¨æœŸãƒ‡ãƒ¼ã‚¿åˆ†æ
print("\n\nğŸŒŠ Test 2: å‘¨æœŸçš„ãƒ‡ãƒ¼ã‚¿åˆ†æï¼ˆæ­£å¼¦æ³¢ï¼‰")
wave = createStatistics()
DEBUG.trackBox(wave, "Statistics-WaveData")

// æ­£å¼¦æ³¢ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ
math = new MathBox()
pi = math.getPi()
i = 0
loop(i < 20) {
    // angle = i * Ï€ / 10
    angle = i * pi * 0.1  // é™¤ç®—ã®ä»£ã‚ã‚Š
    value = math.sin(angle) * 10 + 50  // æŒ¯å¹…10ã€ä¸­å¿ƒ50
    wave.addData(math.round(value))
    i = i + 1
}

wave.showData()
wave.summary()

// å¯¾æ•°æ­£è¦åˆ†å¸ƒé¢¨ã®ãƒ‡ãƒ¼ã‚¿
print("\n\nğŸ“ˆ Test 3: æˆé•·ãƒ‡ãƒ¼ã‚¿åˆ†æï¼ˆæŒ‡æ•°é–¢æ•°çš„ï¼‰")
growth = createStatistics()
DEBUG.trackBox(growth, "Statistics-GrowthData")

i = 1
loop(i <= 10) {
    // æŒ‡æ•°é–¢æ•°çš„æˆé•·ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
    value = math.exp(i * 0.3) * 10
    growth.addData(math.round(value))
    i = i + 1
}

growth.showData()
growth.summary()

// NullBoxæ´»ç”¨ï¼šæ¬ æãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„
print("\n\nğŸ” Test 4: æ¬ æãƒ‡ãƒ¼ã‚¿ã®æ‰±ã„")
incomplete = createStatistics()
incomplete.addData(10)
incomplete.addData(20)
// ç©ºã®ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®çµ±è¨ˆå€¤
empty = createStatistics()
emptyMean = empty.mean()

print("Empty dataset mean is null: " + emptyMean.is_null())

// ãƒ¡ãƒ¢ãƒªä½¿ç”¨çŠ¶æ³
print("\n\nğŸ’¾ Memory Report:")
print(DEBUG.memoryReport())

print("\nâœ… Statistics Calculator completed!")