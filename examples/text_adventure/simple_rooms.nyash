// Text Adventure Game - Simple Rooms Module (without MapBox)
// ãƒ«ãƒ¼ãƒ ã‚·ã‚¹ãƒ†ãƒ ã®ç°¡å˜å®Ÿè£…

include "text_adventure/items.nyash"

// åŸºæœ¬ãƒ«ãƒ¼ãƒ Boxï¼ˆMapBoxãªã—ã®ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
box Room {
    init { name, description, visited, locked, item1, item2, item3, hasItems }
    
    Room(name, description) {
        me.name = name
        me.description = description
        me.visited = false
        me.locked = false
        me.item1 = false
        me.item2 = false
        me.item3 = false
        me.hasItems = 0
    }
    
    // Getter methods to work around field access bug
    getName() {
        return me.name
    }
    
    getDescription() {
        return me.description
    }
    
    isVisited() {
        return me.visited
    }
    
    setVisited(v) {
        me.visited = v
    }
    
    getItemCount() {
        return me.hasItems
    }
    
    getItem1() {
        return me.item1
    }
    
    getItem2() {
        return me.item2
    }
    
    getItem3() {
        return me.item3
    }
    
    // ãƒ«ãƒ¼ãƒ ã®è¡¨ç¤º
    look() {
        result = ""
        if me.isVisited() {
            result = me.getName() + "\n"
        } else {
            result = me.getName() + " (First time here!)\n"
            me.setVisited(true)
        }
        
        result = result + me.getDescription() + "\n"
        
        // ã‚¢ã‚¤ãƒ†ãƒ ã®è¡¨ç¤º
        if me.getItemCount() > 0 {
            result = result + "\nItems here:\n"
            
            item1 = me.getItem1()
            if item1 {
                itemDisplay = item1.display()
                result = result + "- " + itemDisplay + "\n"
            }
            item2 = me.getItem2()
            if item2 {
                itemDisplay = item2.display()
                result = result + "- " + itemDisplay + "\n"
            }
            item3 = me.getItem3()
            if item3 {
                itemDisplay = item3.display()
                result = result + "- " + itemDisplay + "\n"
            }
        }
        
        return result
    }
    
    // ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ 
    addItem(item) {
        if me.hasItems == 0 {
            me.item1 = item
            me.hasItems = 1
        } else {
            if me.hasItems == 1 {
                me.item2 = item
                me.hasItems = 2
            } else {
                if me.hasItems == 2 {
                    me.item3 = item
                    me.hasItems = 3
                }
            }
        }
    }
    
    // ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ï¼ˆå‰Šé™¤ï¼‰
    takeItem(itemName) {
        item1 = me.getItem1()
        if item1 {
            if item1.getName() == itemName {
                result = item1
                me.item1 = false
                me.hasItems = me.hasItems - 1
                return result
            }
        }
        
        item2 = me.getItem2()
        if item2 {
            if item2.getName() == itemName {
                result = item2
                me.item2 = false
                me.hasItems = me.hasItems - 1
                return result
            }
        }
        
        item3 = me.getItem3()
        if item3 {
            if item3.getName() == itemName {
                result = item3
                me.item3 = false
                me.hasItems = me.hasItems - 1
                return result
            }
        }
        
        return false
    }
    
    // ã‚¢ã‚¤ãƒ†ãƒ ã®å­˜åœ¨ç¢ºèª
    hasItem(itemName) {
        item1 = me.getItem1()
        if item1 {
            if item1.getName() == itemName {
                return true
            }
        }
        
        item2 = me.getItem2()
        if item2 {
            if item2.getName() == itemName {
                return true
            }
        }
        
        item3 = me.getItem3()
        if item3 {
            if item3.getName() == itemName {
                return true
            }
        }
        
        return false
    }
}

// ã‚·ãƒ³ãƒ—ãƒ«ãƒ¯ãƒ¼ãƒ«ãƒ‰ä½œæˆé–¢æ•°
function createSimpleWorld() {
    // ã‚¢ã‚¤ãƒ†ãƒ ä½œæˆ
    sword = createSword()
    potion = createPotion()
    key = createKey("treasure_room")
    treasure = createTreasure()
    
    // ãƒ«ãƒ¼ãƒ ä½œæˆ
    entrance = new Room("Entrance Hall", "A grand entrance with marble columns.")
    armory = new Room("Old Armory", "A dusty armory with weapon racks.")
    
    // ã‚¢ã‚¤ãƒ†ãƒ é…ç½®
    armory.addItem(sword)
    entrance.addItem(potion)
    entrance.addItem(key)
    
    return entrance  // ã‚¹ã‚¿ãƒ¼ãƒˆåœ°ç‚¹
}

print("ğŸ° Simple Rooms module loaded successfully!")