// Text Adventure Game - Player Module
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚·ã‚¹ãƒ†ãƒ ã®å®Ÿè£…

include "text_adventure/simple_rooms.nyash"

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼Box
box Player {
    init { name, health, currentRoom, inventory1, inventory2, inventory3, inventoryCount }
    
    Player(name, startRoom) {
        me.name = name
        me.health = 100
        me.currentRoom = startRoom
        me.inventory1 = false
        me.inventory2 = false  
        me.inventory3 = false
        me.inventoryCount = 0
    }
    
    // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹è¡¨ç¤º
    status() {
        result = "=== Player Status ===\n"
        result = result + "Name: " + me.name + "\n"
        result = result + "Health: " + me.health + "\n"
        result = result + "Location: " + me.currentRoom.getName() + "\n"
        
        if me.inventoryCount > 0 {
            result = result + "\nInventory:\n"
            
            if me.inventory1 {
                itemDisplay = me.inventory1.display()
                result = result + "- " + itemDisplay + "\n"
            }
            if me.inventory2 {
                itemDisplay = me.inventory2.display()
                result = result + "- " + itemDisplay + "\n"
            }
            if me.inventory3 {
                itemDisplay = me.inventory3.display()
                result = result + "- " + itemDisplay + "\n"
            }
        } else {
            result = result + "\nInventory: Empty\n"
        }
        
        return result
    }
    
    // ç¾åœ¨ã®éƒ¨å±‹ã‚’è¦‹ã‚‹
    look() {
        return me.currentRoom.look()
    }
    
    // ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ‹¾ã†
    take(itemName) {
        if me.inventoryCount >= 3 {
            return "Inventory is full! Cannot take more items."
        }
        
        if me.currentRoom.hasItem(itemName) {
            item = me.currentRoom.takeItem(itemName)
            if item {
                // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã«è¿½åŠ 
                if me.inventoryCount == 0 {
                    me.inventory1 = item
                    me.inventoryCount = 1
                } else {
                    if me.inventoryCount == 1 {
                        me.inventory2 = item
                        me.inventoryCount = 2
                    } else {
                        if me.inventoryCount == 2 {
                            me.inventory3 = item
                            me.inventoryCount = 3
                        }
                    }
                }
                itemName = item.name
                return "Picked up: " + itemName
            } else {
                return "Failed to take item."
            }
        } else {
            return "Item not found in this room."
        }
    }
    
    // ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½¿ç”¨
    use(itemName) {
        target = false
        slot = 0
        
        // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªå†…ã§ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¤œç´¢
        if me.inventory1 {
            if me.inventory1.name == itemName {
                target = me.inventory1
                slot = 1
            }
        }
        
        if me.inventory2 {
            if me.inventory2.name == itemName {
                target = me.inventory2
                slot = 2
            }
        }
        
        if me.inventory3 {
            if me.inventory3.name == itemName {
                target = me.inventory3
                slot = 3
            }
        }
        
        if target {
            // ã‚¢ã‚¤ãƒ†ãƒ ã‚¿ã‚¤ãƒ—ã«å¿œã˜ãŸå‡¦ç†
            if target.damage {
                // æ­¦å™¨ã®å ´åˆ
                damage = target.use()
                if damage > 0 {
                    return "Used weapon and dealt " + damage + " damage!"
                } else {
                    return "Weapon is broken!"
                }
            } else {
                if target.effect {
                    // æ¶ˆè²»ã‚¢ã‚¤ãƒ†ãƒ ã®å ´åˆ
                    effect = target.use()
                    if effect > 0 {
                        me.health = me.health + effect
                        if me.health > 100 {
                            me.health = 100
                        }
                        
                        // ä½¿ã„åˆ‡ã£ãŸå ´åˆã¯å‰Šé™¤
                        if target.uses <= 0 {
                            if slot == 1 {
                                me.inventory1 = false
                            } else {
                                if slot == 2 {
                                    me.inventory2 = false
                                } else {
                                    if slot == 3 {
                                        me.inventory3 = false
                                    }
                                }
                            }
                            me.inventoryCount = me.inventoryCount - 1
                            return "Used " + itemName + " and restored " + effect + " health. Item consumed."
                        } else {
                            return "Used " + itemName + " and restored " + effect + " health."
                        }
                    } else {
                        return "Item is empty!"
                    }
                } else {
                    // ãã®ä»–ã®ã‚¢ã‚¤ãƒ†ãƒ 
                    return "Used " + itemName + "."
                }
            }
        } else {
            return "You don't have that item."
        }
    }
    
    // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã®è¡¨ç¤º
    inventory() {
        if me.inventoryCount == 0 {
            return "Inventory is empty."
        }
        
        result = "Inventory:\n"
        
        if me.inventory1 {
            itemDisplay = me.inventory1.display()
            result = result + "1. " + itemDisplay + "\n"
        }
        if me.inventory2 {
            itemDisplay = me.inventory2.display()
            result = result + "2. " + itemDisplay + "\n"
        }
        if me.inventory3 {
            itemDisplay = me.inventory3.display()
            result = result + "3. " + itemDisplay + "\n"
        }
        
        return result
    }
    
    // ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
    help() {
        result = "=== Available Commands ===\n"
        result = result + "look - Look around the current room\n"
        result = result + "take <item> - Pick up an item\n"
        result = result + "use <item> - Use an item from inventory\n"
        result = result + "inventory - Show your inventory\n"
        result = result + "status - Show player status\n"
        result = result + "help - Show this help\n"
        return result
    }
}

// ã‚²ãƒ¼ãƒ åˆæœŸåŒ–é–¢æ•°
function startGame(playerName) {
    world = createSimpleWorld()
    player = new Player(playerName, world)
    
    print("ğŸ® Welcome to the Text Adventure Game!")
    print("Player: " + playerName)
    print("")
    print(player.look())
    
    return player
}

print("ğŸ® Player module loaded successfully!")