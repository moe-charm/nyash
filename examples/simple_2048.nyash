// ğŸ® ã‚·ãƒ³ãƒ—ãƒ«2048ã‚²ãƒ¼ãƒ  - Nyash Everything is Boxå®Ÿè¨¼

print("ğŸ® === Simple 2048 Game ===")

// ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½
DEBUG = new DebugBox()
DEBUG.startTracking()

// ğŸ”¢ ã‚·ãƒ³ãƒ—ãƒ«ã‚¿ã‚¤ãƒ«Box
box SimpleTile {
    init { value }
    
    SimpleTile(initialValue) {
        me.value = initialValue
    }
    
    getValue() {
        return me.value
    }
    
    setValue(newValue) {
        me.value = newValue
    }
    
    isEmpty() {
        return me.value == 0
    }
    
    toString() {
        if me.value == 0 {
            return "."
        }
        return me.value.toString()
    }
}

// ğŸ² ã‚·ãƒ³ãƒ—ãƒ«ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰Box
box SimpleGameBoard {
    init { grid, score }
    
    SimpleGameBoard() {
        me.grid = new ArrayBox()
        me.score = 0
        
        // 4x4ã‚°ãƒªãƒƒãƒ‰åˆæœŸåŒ–
        row = 0
        loop(row < 4) {
            rowArray = new ArrayBox()
            col = 0
            loop(col < 4) {
                tile = new SimpleTile(0)
                rowArray.push(tile)
                col = col + 1
            }
            me.grid.push(rowArray)
            row = row + 1
        }
        
        DEBUG.trackBox(me.grid, "simple_grid")
    }
    
    // ã‚¿ã‚¤ãƒ«å–å¾—
    getTile(x, y) {
        if x >= 0 && x < 4 && y >= 0 && y < 4 {
            row = me.grid.get(x)
            return row.get(y)
        }
        // ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ç”¨ãƒ€ãƒŸãƒ¼ã‚¿ã‚¤ãƒ«
        return new SimpleTile(-1)
    }
    
    // ã‚¿ã‚¤ãƒ«è¨­å®š
    setTile(x, y, value) {
        if x >= 0 && x < 4 && y >= 0 && y < 4 {
            row = me.grid.get(x)
            tile = row.get(y)
            tile.setValue(value)
        }
    }
    
    // ç©ºã®ã‚»ãƒ«ã«2ã‚’è¿½åŠ ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
    addRandomTile() {
        // æœ€åˆã®ç©ºã„ã¦ã‚‹ã‚»ãƒ«ã«2ã‚’è¿½åŠ 
        row = 0
        loop(row < 4) {
            col = 0
            loop(col < 4) {
                tile = me.getTile(row, col)
                if tile.isEmpty() {
                    me.setTile(row, col, 2)
                    print("ğŸ² Added 2 at (" + row + "," + col + ")")
                    return true
                }
                col = col + 1
            }
            row = row + 1
        }
        return false
    }
    
    // ãƒœãƒ¼ãƒ‰è¡¨ç¤º
    display() {
        print("ğŸ“Š Score: " + me.score)
        print("â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”")
        
        row = 0
        loop(row < 4) {
            line = "â”‚"
            col = 0
            loop(col < 4) {
                tile = me.getTile(row, col)
                value = tile.getValue()
                if value == 0 {
                    line = line + "    "
                } else if value < 10 {
                    line = line + "   " + value
                } else if value < 100 {
                    line = line + "  " + value  
                } else if value < 1000 {
                    line = line + " " + value
                } else {
                    line = line + value.toString()
                }
                line = line + "â”‚"
                col = col + 1
            }
            print(line)
            
            if row < 3 {
                print("â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤")
            }
            row = row + 1
        }
        print("â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜")
    }
    
    // ã‚·ãƒ³ãƒ—ãƒ«å·¦ç§»å‹•
    moveLeft() {
        moved = false
        
        row = 0
        loop(row < 4) {
            // å„è¡Œã®å€¤ã‚’é…åˆ—ã«é›†ã‚ã‚‹
            values = new ArrayBox()
            col = 0
            loop(col < 4) {
                tile = me.getTile(row, col)
                if tile.getValue() > 0 {
                    values.push(tile.getValue())
                }
                col = col + 1
            }
            
            // ãƒãƒ¼ã‚¸å‡¦ç†ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰
            if values.length() >= 2 {
                i = 0
                loop(i < values.length() - 1) {
                    val1 = values.get(i)
                    val2 = values.get(i + 1)
                    if val1 == val2 {
                        newValue = val1 * 2
                        values.set(i, newValue)
                        values.removeAt(i + 1)
                        me.score = me.score + newValue
                        print("âœ¨ Merged " + val1 + " + " + val2 + " = " + newValue)
                        break  // ä¸€å›ã®ã¿ãƒãƒ¼ã‚¸
                    }
                    i = i + 1
                }
            }
            
            // è¡Œã‚’æ›´æ–°
            col = 0
            loop(col < 4) {
                oldTile = me.getTile(row, col)
                oldValue = oldTile.getValue()
                
                if col < values.length() {
                    newValue = values.get(col)
                } else {
                    newValue = 0
                }
                
                if oldValue != newValue {
                    moved = true
                    me.setTile(row, col, newValue)
                }
                col = col + 1
            }
            
            row = row + 1
        }
        
        return moved
    }
}

// ğŸ® ã‚·ãƒ³ãƒ—ãƒ«ã‚²ãƒ¼ãƒ Box
box SimpleGame2048 {
    init { board, moves, gameStarted }
    
    SimpleGame2048() {
        me.board = new SimpleGameBoard()
        me.moves = 0
        me.gameStarted = false
        
        DEBUG.trackBox(me.board, "simple_game_board")
    }
    
    start() {
        print("ğŸš€ Starting Simple 2048 game...")
        
        // åˆæœŸã‚¿ã‚¤ãƒ«2å€‹è¿½åŠ 
        me.board.addRandomTile()
        me.board.addRandomTile()
        
        me.gameStarted = true
        me.board.display()
        
        return me
    }
    
    move(direction) {
        if me.gameStarted == false {
            print("âŒ Game not started!")
            return false
        }
        
        moved = false
        
        if direction == "left" {
            moved = me.board.moveLeft()
        } else {
            print("âš ï¸ Only 'left' direction implemented")
            return false
        }
        
        if moved {
            me.moves = me.moves + 1
            me.board.addRandomTile()
            
            print("\nğŸ“± Move " + me.moves + " (left):")
            me.board.display()
        } else {
            print("âš ï¸ No movement possible")
        }
        
        return moved
    }
}

// ğŸš€ ã‚²ãƒ¼ãƒ å®Ÿè¡Œ
print("ğŸ¯ Testing Simple 2048...")

game = new SimpleGame2048()
DEBUG.trackBox(game, "main_simple_game")

// ã‚²ãƒ¼ãƒ é–‹å§‹
game.start()

// ç§»å‹•ãƒ†ã‚¹ãƒˆ
print("\n=== Movement Testing ===")
game.move("left")
game.move("left")
game.move("left")

// ãƒ‡ãƒãƒƒã‚°æƒ…å ±
print("\nğŸ“Š === Debug Report ===")
print(DEBUG.memoryReport())

print("\nğŸ‰ Simple 2048 completed!")
print("Nyashã§2048ã‚²ãƒ¼ãƒ ãŒå‹•ã„ãŸã«ã‚ƒï¼ ğŸ®âœ¨")