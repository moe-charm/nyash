// ğŸ§® ã‚·ãƒ³ãƒ—ãƒ«Nyashè¨ˆç®—æ©Ÿ - Everything is Boxå®Ÿè¨¼

print("ğŸ§® === Simple Nyash Calculator ===")

// ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½
DEBUG = new DebugBox()
DEBUG.startTracking()

// ğŸ¯ å¼è©•ä¾¡Box - ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆ
box SimpleCalculator {
    init { name, operations }
    
    SimpleCalculator() {
        me.name = "Nyash Simple Calculator"
        me.operations = new ArrayBox()
    }
    
    // åŠ ç®—
    add(a, b) {
        result = a + b
        operation = "add(" + a + ", " + b + ") = " + result
        me.operations.push(operation)
        print("â• " + operation)
        return result
    }
    
    // æ¸›ç®—  
    subtract(a, b) {
        result = a - b
        operation = "subtract(" + a + ", " + b + ") = " + result
        me.operations.push(operation)
        print("â– " + operation)
        return result
    }
    
    // ä¹—ç®—
    multiply(a, b) {
        result = a * b
        operation = "multiply(" + a + ", " + b + ") = " + result
        me.operations.push(operation)
        print("âœ–ï¸ " + operation)
        return result
    }
    
    // è¤‡åˆæ¼”ç®—
    complex(a, b, c) {
        print("ğŸ”„ Complex operation: a + b * c where a=" + a + ", b=" + b + ", c=" + c)
        
        // æ¼”ç®—å­å„ªå…ˆåº¦ã‚’è€ƒæ…®: b * c ã‚’å…ˆã«è¨ˆç®—
        step1 = me.multiply(b, c)
        result = me.add(a, step1)
        
        print("ğŸ“Š Final result: " + result)
        return result
    }
    
    // å±¥æ­´è¡¨ç¤º
    showHistory() {
        print("ğŸ“š Operation History:")
        i = 0
        loop(i < me.operations.length()) {
            print("  " + (i + 1) + ": " + me.operations.get(i))
            i = i + 1
        }
    }
}

// ğŸ¯ æ•°å€¤ãƒšã‚¢Box - ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹æ´»ç”¨
box NumberPair<T> {
    init { first, second }
    
    NumberPair(a, b) {
        me.first = a
        me.second = b
    }
    
    sum() {
        return me.first + me.second
    }
    
    product() {
        return me.first * me.second
    }
    
    toString() {
        return "Pair(" + me.first + ", " + me.second + ")"
    }
}

// ğŸ“¦ æ±ç”¨ã‚³ãƒ³ãƒ†ãƒŠBox - ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹å®Ÿè£…
box Container<T> {
    init { value }
    
    Container(initialValue) {
        me.value = initialValue
    }
    
    setValue(newValue) {
        me.value = newValue
    }
    
    getValue() {
        return me.value
    }
}

// ğŸ§® é«˜åº¦è¨ˆç®—Box
box AdvancedCalculator {
    init { pairs, results }
    
    AdvancedCalculator() {
        me.pairs = new ArrayBox()
        me.results = new Container<IntegerBox>(0)
    }
    
    // ãƒšã‚¢è¿½åŠ 
    addPair(a, b) {
        pair = new NumberPair<IntegerBox>(a, b)
        me.pairs.push(pair)
        DEBUG.trackBox(pair, "pair_" + me.pairs.length())
        print("ğŸ“¦ Added pair: " + pair.toString())
        return pair
    }
    
    // å…¨ãƒšã‚¢ã®åˆè¨ˆè¨ˆç®—
    calculateAllSums() {
        print("ğŸ”¢ Calculating sums for all pairs:")
        totalSum = 0
        
        i = 0
        loop(i < me.pairs.length()) {
            pair = me.pairs.get(i)
            pairSum = pair.sum()
            totalSum = totalSum + pairSum
            print("  " + pair.toString() + " sum = " + pairSum)
            i = i + 1
        }
        
        me.results.setValue(totalSum)
        print("ğŸ¯ Total sum: " + totalSum)
        return totalSum
    }
    
    // å…¨ãƒšã‚¢ã®ç©è¨ˆç®—
    calculateAllProducts() {
        print("âœ–ï¸ Calculating products for all pairs:")
        totalProduct = 1
        
        i = 0
        loop(i < me.pairs.length()) {
            pair = me.pairs.get(i)
            pairProduct = pair.product()
            totalProduct = totalProduct * pairProduct
            print("  " + pair.toString() + " product = " + pairProduct)
            i = i + 1
        }
        
        print("ğŸ¯ Total product: " + totalProduct)
        return totalProduct
    }
}

// ğŸš€ ãƒ¡ã‚¤ãƒ³å®Ÿè¡Œ
print("ğŸ¯ Testing Simple Calculator...")

calc = new SimpleCalculator()
DEBUG.trackBox(calc, "main_calculator")

// åŸºæœ¬æ¼”ç®—ãƒ†ã‚¹ãƒˆ
print("\n=== Basic Operations ===")
calc.add(5, 3)
calc.subtract(10, 4) 
calc.multiply(6, 7)

// è¤‡åˆæ¼”ç®—ãƒ†ã‚¹ãƒˆ  
print("\n=== Complex Operations ===")
calc.complex(2, 3, 4)  // 2 + 3 * 4 = 14
calc.complex(1, 5, 2)  // 1 + 5 * 2 = 11

// å±¥æ­´è¡¨ç¤º
print("\n=== History ===")
calc.showHistory()

// é«˜åº¦è¨ˆç®—å™¨ãƒ†ã‚¹ãƒˆ
print("\n=== Advanced Calculator ===")
advCalc = new AdvancedCalculator()
DEBUG.trackBox(advCalc, "advanced_calculator")

// ãƒšã‚¢è¿½åŠ 
advCalc.addPair(3, 4)
advCalc.addPair(5, 6)  
advCalc.addPair(2, 8)

// è¨ˆç®—å®Ÿè¡Œ
advCalc.calculateAllSums()
advCalc.calculateAllProducts()

// ãƒ‡ãƒãƒƒã‚°æƒ…å ±
print("\nğŸ“Š === Debug Report ===")
print(DEBUG.memoryReport())

print("\nğŸ‰ Simple Calculator completed!")
print("Nyashã® Everything is Box å“²å­¦ã«ã‚ˆã‚‹è¨ˆç®—æ©ŸãŒå®Œæˆã«ã‚ƒï¼")