// ğŸ“¦ ConsBox - ã‚·ãƒ³ãƒ—ãƒ«ãªLISP cons cellå®Ÿè£…
// ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°ç‰ˆ

// ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªnilå€¤ï¼ˆ0ã‚’ä½¿ç”¨ï¼‰
NIL = 0

box ConsBox {
    car
    cdr
    
    init { car, cdr }
    
    // ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å¼•æ•°å¯¾å¿œ
    ConsBox(a, d) {
        me.car = a
        me.cdr = d
    }
    
    getCar() { return me.car }
    getCdr() { return me.cdr }
    setCar(value) { me.car = value }
    setCdr(value) { me.cdr = value }
    
    // æ”¹è‰¯ã•ã‚ŒãŸtoString()ãƒ¡ã‚½ãƒƒãƒ‰ - ãƒ—ãƒ­ãƒ‘ãƒ¼ãƒªã‚¹ãƒˆå¯¾å¿œ
    toString() {
        return "(" + me.toStringList() + ")"
    }
    
    // ãƒªã‚¹ãƒˆè¦ç´ ã‚’åé›†ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
    toStringList() {
        // carã®æ–‡å­—åˆ—è¡¨ç¾
        carStr = ""
        if me.car == NIL {
            carStr = "nil"
        } else {
            carStr = me.car.toString()
        }
        
        // cdrã®å‡¦ç†
        if me.cdr == NIL {
            // æœ€å¾Œã®è¦ç´ 
            return carStr
        } else {
            // cdrãŒConsBoxã®å ´åˆã¯ãƒªã‚¹ãƒˆç¶™ç¶š
            if me.isConsBox(me.cdr) {
                return carStr + " " + me.cdr.toStringList()
            } else {
                // ã‚¤ãƒ³ãƒ—ãƒ­ãƒ‘ãƒ¼ãƒªã‚¹ãƒˆ
                cdrStr = me.cdr.toString()
                return carStr + " . " + cdrStr
            }
        }
    }
    
    // ConsBoxã‹ã©ã†ã‹ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆæ”¹è‰¯ç‰ˆï¼‰
    isConsBox(obj) {
        if obj == NIL { return false }
        if obj == 0 { return false }
        if obj == 1 { return false }
        if obj == 2 { return false }
        if obj == 3 { return false }
        if obj == 4 { return false }
        if obj == 5 { return false }
        if obj == 6 { return false }
        if obj == 7 { return false }
        if obj == 8 { return false }
        if obj == 9 { return false }
        // æ–‡å­—åˆ—ãƒã‚§ãƒƒã‚¯ï¼ˆç°¡æ˜“ç‰ˆï¼‰
        if obj == "a" { return false }
        if obj == "b" { return false }
        if obj == "c" { return false }
        if obj == "" { return false }
        // ãã‚Œä»¥å¤–ã¯ConsBoxã¨ä»®å®š
        return true
    }
}

// åŸºæœ¬é–¢æ•°
function cons(a, d) {
    return new ConsBox(a, d)
}

function car(pair) {
    if pair == NIL { return NIL }
    return pair.getCar()
}

function cdr(pair) {
    if pair == NIL { return NIL }
    return pair.getCdr()
}

// ãƒªã‚¹ãƒˆä½œæˆé–¢æ•°
function list1(a) {
    return cons(a, NIL)
}

function list2(a, b) {
    return cons(a, cons(b, NIL))
}

function list3(a, b, c) {
    return cons(a, cons(b, cons(c, NIL)))
}

// ãƒ†ã‚¹ãƒˆ
print("=== Simple ConsBox Test ===")
print("")

// åŸºæœ¬çš„ãªcons
print("1. Basic cons cells:")
p1 = cons(1, 2)
print("   (cons 1 2) = " + p1.toString())
p2 = new ConsBox(3, 4)
print("   new ConsBox(3, 4) = " + p2.toString())

// ãƒªã‚¹ãƒˆ
print("")
print("2. Lists:")
l1 = list3("a", "b", "c")
print("   (list 'a' 'b' 'c') = " + l1.toString())

// car/cdr
print("")
print("3. car/cdr:")
print("   (car l1) = " + car(l1))
print("   (cdr l1) = " + cdr(l1).toString())

// ãƒã‚¹ãƒˆ
print("")
print("4. Nested structures:")
nested = cons(cons(1, 2), cons(3, 4))
print("   ((1 . 2) . (3 . 4)) = " + nested.toString())

print("")
print("âœ… Done!")