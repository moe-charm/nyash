// ğŸš€ æœ€å°ç‰ˆLISP - å‹•ä½œç¢ºèªç”¨
// åŸºæœ¬çš„ãªç®—è¡“è¨ˆç®—ã®ã¿å®Ÿè£…

NIL = 0

// ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
box ConsBox {
    car
    cdr
    init { car, cdr }
    ConsBox(a, d) { 
        me.car = a
        me.cdr = d 
    }
    getCar() { return me.car }
    getCdr() { return me.cdr }
    toString() { return "(" + me.car.toString() + " . " + me.cdr.toString() + ")" }
}

// åŸºæœ¬é–¢æ•°
function cons(a, d) { return new ConsBox(a, d) }
function car(pair) { 
    if pair == NIL { return NIL }
    return pair.getCar() 
}
function cdr(pair) { 
    if pair == NIL { return NIL }
    return pair.getCdr() 
}

// ãƒªã‚¹ãƒˆä½œæˆ
function list2(a, b) { return cons(a, cons(b, NIL)) }
function list3(a, b, c) { return cons(a, cons(b, cons(c, NIL))) }

// è¶…ã‚·ãƒ³ãƒ—ãƒ«è©•ä¾¡å™¨ - æ•°å€¤ã®åŠ ç®—ã®ã¿
function simpleEval(expr) {
    // æ•°å€¤ãƒªãƒ†ãƒ©ãƒ«ã¯ãã®ã¾ã¾è¿”ã™
    if expr == 0 { return 0 }
    if expr == 1 { return 1 }
    if expr == 2 { return 2 }
    if expr == 3 { return 3 }
    if expr == 4 { return 4 }
    if expr == 5 { return 5 }
    if expr == 6 { return 6 }
    if expr == 7 { return 7 }
    if expr == 8 { return 8 }
    if expr == 9 { return 9 }
    
    // ãƒªã‚¹ãƒˆã®å ´åˆ
    operator = car(expr)
    arg1 = car(cdr(expr))
    arg2 = car(cdr(cdr(expr)))
    
    // æ–‡å­—åˆ—ã®åŠ ç®—æ¼”ç®—å­ãƒã‚§ãƒƒã‚¯
    if operator == "+" {
        return simpleEval(arg1) + simpleEval(arg2)
    }
    if operator == "*" {
        return simpleEval(arg1) * simpleEval(arg2)
    }
    if operator == "-" {
        return simpleEval(arg1) - simpleEval(arg2)
    }
    
    return 0  // ã‚¨ãƒ©ãƒ¼ã®å ´åˆ
}

// ãƒ†ã‚¹ãƒˆ
print("ğŸš€ === Minimal LISP Test === ğŸš€")
print("")

print("1. Basic data structures:")
p1 = cons(1, 2)
print("   cons(1, 2) = " + p1.toString())
print("   car = " + car(p1))
print("   cdr = " + cdr(p1))

print("")
print("2. Simple evaluation:")
// (+ 1 2) ã‚’æ‰‹å‹•æ§‹ç¯‰
expr1 = list3("+", 1, 2)
print("   Expression: " + expr1.toString())
result1 = simpleEval(expr1)
print("   Result: " + result1)

print("")
print("3. Nested expression:")
// (+ 1 (* 2 3))
inner = list3("*", 2, 3)
expr2 = list3("+", 1, inner)
print("   Expression: " + expr2.toString())
result2 = simpleEval(expr2)
print("   Result: " + result2)

print("")
print("âœ… Minimal LISP working!")
print("ğŸ¯ This proves the concept - now we can build more features!")