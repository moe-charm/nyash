# PR #75 SocketBoxçŠ¶æ…‹ä¿æŒãƒ†ã‚¹ãƒˆ
# Arc<dyn NyashBox>ä¿®æ­£åŠ¹æœã®æ¤œè¨¼

static box Main {
    init { console, server, result }
    
    main() {
        me.console = new ConsoleBox()
        me.console.log("ğŸ”¥ SocketBoxçŠ¶æ…‹ä¿æŒãƒ†ã‚¹ãƒˆé–‹å§‹")
        
        # SocketBoxä½œæˆ
        me.server = new SocketBox()
        me.console.log("âœ… SocketBoxä½œæˆå®Œäº†")
        
        # bindå‰ã®isServerç¢ºèª
        local isServerBefore = me.server.isServer()
        me.console.log("Before bind: isServer = " + isServerBefore.toString())
        
        # bindå®Ÿè¡Œï¼ˆçŠ¶æ…‹è¨­å®šï¼‰
        local bindResult = me.server.bind("127.0.0.1", 18080)
        me.console.log("Bind result = " + bindResult.toString())
        
        # bindå¾Œã®isServerç¢ºèªï¼ˆğŸ¯ é‡è¦ï¼šã“ã‚ŒãŒtrueã«ãªã‚‹ã¹ãï¼‰
        local isServerAfter = me.server.isServer()
        me.console.log("After bind: isServer = " + isServerAfter.toString())
        
        # ãƒ†ã‚¹ãƒˆçµæœåˆ¤å®š
        if isServerAfter.equals(true) {
            me.console.log("ğŸ‰ SUCCESS: SocketBoxçŠ¶æ…‹ä¿æŒä¿®æ­£å®Œäº†!")
            me.result = "PASS: State preservation works"
        } else {
            me.console.log("âŒ FAILED: SocketBoxçŠ¶æ…‹ãŒå¤±ã‚ã‚Œã¦ã„ã‚‹")
            me.result = "FAIL: State preservation broken"
        }
        
        # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
        me.server.close()
        me.console.log("ğŸ§¹ SocketBox closed")
        
        return me.result
    }
}