// 両方のBoxがMapBoxを持ち3引数テスト

print("=== Double MapBox 3-Args Test ===")

box BoxA {
    init { data, nodeId }
    
    setup() {
        print("BoxA setup start")
        me.data = new MapBox()
        me.nodeId = "NodeA"
        print("BoxA setup complete with MapBox")
    }
    
    callOther(other) {
        print("BoxA calling other with 3 args...")
        other.receive("message", "data", me.nodeId)  // 3引数 + フィールドアクセス
    }
}

box BoxB {
    init { storage }
    
    setup() {
        print("BoxB setup start")
        me.storage = new MapBox()  // こちらもMapBox
        print("BoxB setup complete with MapBox")
    }
    
    receive(type, data, from) {
        print("BoxB received: " + from + " -> " + type + " = " + data)
    }
}

print("Creating BoxA with MapBox...")
local boxA
boxA = new BoxA()
boxA.setup()

print("Creating BoxB with MapBox...")
local boxB
boxB = new BoxB()
boxB.setup()

print("Testing 3-arg cross-box call (both have MapBox)...")
boxA.callOther(boxB)

print("Double MapBox 3-arg test completed!")